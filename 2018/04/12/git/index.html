<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Git | simyy</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Git是一个开源的分布式版本控制系统。">
<meta name="keywords" content="Git">
<meta property="og:type" content="article">
<meta property="og:title" content="Git">
<meta property="og:url" content="http://simyy.cn/2018/04/12/git/index.html">
<meta property="og:site_name" content="simyy">
<meta property="og:description" content="Git是一个开源的分布式版本控制系统。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://simyy.cn/images/15240979976862.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240980359546.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240980465160.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240980763614.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240981123981.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240981214130.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240981289836.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240981389227.jpg">
<meta property="og:image" content="http://simyy.cn/images/15240981445332.jpg">
<meta property="og:updated_time" content="2019-11-28T10:45:53.619Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Git">
<meta name="twitter:description" content="Git是一个开源的分布式版本控制系统。">
<meta name="twitter:image" content="http://simyy.cn/images/15240979976862.jpg">
  
    <link rel="alternative" href="/atom.xml" title="simyy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head></html>
<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">simyy</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://simyy.cn"></form>
	</div>
</header>
    <div id="main">
      <article id="post-git" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2018/04/12/git/" class="article-date">
  <time datetime="2018-04-12T00:30:42.000Z" itemprop="datePublished">2018-04-12</time>
</a>

		</span>
        <span class="tags">
	       	
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

		</span>
		<!--span class="meta-elements author">simyy</span-->
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      Git
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Git是一个开源的分布式版本控制系统。</p>
<a id="more"></a>
<h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><p>Git的作者是大名鼎鼎的<code>Linus（Linux的创始人</code>）。</p>
<blockquote>
<p><a href="http://geek.csdn.net/news/detail/30067" target="_blank" rel="noopener"><code>Linux创始人Linus Torvalds访谈，Git的十年之旅</code></a> <a href="https://www.linuxfoundation.org/blog/10-years-of-git-an-interview-with-git-creator-linus-torvalds/" target="_blank" rel="noopener">英文</a></p>
</blockquote>
<h3 id="为什么要创建Git？"><a href="#为什么要创建Git？" class="headerlink" title="为什么要创建Git？"></a>为什么要创建Git？</h3><p><strong>阶段一</strong>：起初参与Linux开源项目的代码是由Linus本人通过<code>diff和patch</code>命令来<code>手动</code>为别人整合代码的，但是代码库之大<code>很难</code>继续通过<code>手工方式管理</code>了。</p>
<p><strong>阶段二</strong>：为了解决上一个问题，开始使用版本控制工具<code>BitKeeper</code>，但注意它<code>并非开源的</code>。</p>
<p><strong>阶段三</strong>：开发Samba的Andrew试图破解BitKeeper的协议，被BitMover公司发现并收回Linux社区的免费使用权。</p>
<p><strong>阶段四</strong>：工具没了，咋整？Linus花了两周时间自己用C写了一个<code>分布式版本控制系统</code>，这就是<code>Git</code>！一个月之内，Linux系统的源码已经由Git管理了！</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><img src="/images/15240979976862.jpg" alt=""></p>
<h3 id="工作区-amp-版本库"><a href="#工作区-amp-版本库" class="headerlink" title="工作区&amp;版本库"></a>工作区&amp;版本库</h3><p>在初始化git版本库之后会生成一个隐藏的文件<code>.git</code> ，可以将该文件理解为git的<code>版本库</code>。</p>
<p>项目文件夹属于<code>工作区</code>，在<code>.git</code> 文件夹里面还有很多文件，其中有一个<code>index 文件</code>就是<code>暂存区（也可以叫做 stage）</code> 。</p>
<blockquote>
<p>每当编辑好一个或几个文件后，通过add操作把它加入到暂存区，然后接着修改其他文件，改好后放入暂存区，循环反复直到修改完毕，最后使用 commit 命令，将暂存区的内容永久保存到本地仓库。这个过程其实就是构建项目快照的过程，当我们提交时，git 会使用暂存区的这些信息生成tree对象，也就是项目快照，永久保存到数据库中，因此也可以说暂存区是用来构建项目快照的区域。</p>
</blockquote>
<p><img src="/images/15240980359546.jpg" alt=""></p>
<p>git还为我们自动生成了一个分支<code>master（默认分支）</code>以及指向该分支的<code>指针head</code>·。</p>
<h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><p><code>objects</code>是用来存储git数据，具体可以分为<code>blob</code>、<code>tree</code>和<code>commit</code>。</p>
<hr>
<p><code>blob</code>用来存放项目文件的内容，但是不包括文件的路径、名字、格式等其它描述信息。项目的任意文件的任意版本都是以blob的形式存放的。</p>
<p><code>tree</code>用来表示目录。项目就是一个目录，其中包括文件、子目录，因此 tree 中有 blob、子tree。</p>
<blockquote>
<p><code>blob</code>和<code>tree</code>是使用 sha-1值引用的（将文件中的内容通过通过计算生成一个 40 位长度的hash值，其特点：由文件内容计算出的hash值hash值相同，文件内容相同）。</p>
</blockquote>
<p><code>commit</code>表示一次提交，有parent字段，用来引用父提交。指向了一个顶层 tree，表示了项目的快照，还有一些其它的信息，比如上一个提交，committer、author、message 等信息。</p>
<hr>
<p><img src="/images/15240980465160.jpg" alt=""></p>
<blockquote>
<p>从顶层的 tree 纵览整个树状的结构，叶子结点就是blob，表示文件的内容，非叶子结点表示项目的目录，而<code>顶层的 tree 对象就代表了当前项目的快照</code>。</p>
</blockquote>
<h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><p><img src="/images/15240980763614.jpg" alt=""></p>
<p><code>分支的目的</code>是让我们可以并行的进行开发。</p>
<p>比如我们当前正在开发功能，但是需要修复一个紧急bug，我们不可能在这个项目正在修改的状态下修复 bug，因为这样会引入更多的bug。</p>
<p>分支的实现其实很简单，我们可以先看一下 .git/HEAD 文件，它保存了当前的分支，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/work/communitycenter   features/0412 ●✚  cat .git/HEAD</span><br><span class="line">ref: refs/heads/features/0412</span><br></pre></td></tr></table></figure>
<p><code>Git 的分支</code>本质上仅仅是指向提交<code>对象的可变指针</code>。 Git 的默认分支名字是<code>master</code>。 在多次提交操作之后，你其实已经有一个指向最后那个提交对象的 commit。 它会在每次的提交操作中自动向前移动。</p>
<blockquote>
<p>Git 的 “master” 分支并不是一个特殊分支。 它就跟其它分支完全没有区别。 之所以几乎每一个仓库都有 master 分支，是因为 git init 命令默认创建它，并且大多数人都懒得去改动它。</p>
</blockquote>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h3><p>修改分支之前应该需要修改好用户名和邮箱，这样才知道当前的修改属于谁。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config user.email xxxx 设置邮箱</span><br><span class="line">git config user.name yyyy 设置用户名</span><br></pre></td></tr></table></figure>
<h3 id="Merge-amp-Rebase"><a href="#Merge-amp-Rebase" class="headerlink" title="Merge &amp; Rebase"></a>Merge &amp; Rebase</h3><p>在 git 中合并分支有两种选择：<code>merge</code>和<code>rebase</code>，但是无论哪一种，都有可能产生冲突。</p>
<blockquote>
<p>冲突的产生：两个已经提交的分支的<code>相同文件相同位置的的不同操作进行了合并</code>。</p>
</blockquote>
<p><img src="/images/15240981123981.jpg" alt=""></p>
<p>由于并行开发，<code>master</code>分支和<code>feature</code>分支出现了并行情况，并且同时更改了相同文件的相同位置，造成了冲突。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;HEAD</span><br><span class="line">other code</span><br><span class="line"></span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">your code</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;your branch name</span><br></pre></td></tr></table></figure>
<h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><p><code>Merge</code>会把不同分支的commit合并（<code>保留commit的时间线</code>）起来，通过新增一个新的commit来实现冲突的解决。</p>
<p>在没有冲突的情况下，<code>Merge</code>合并情况如下，其中<code>7</code>为合并的<code>commit</code>，</p>
<p><img src="/images/15240981214130.jpg" alt=""></p>
<blockquote>
<p>如果发生冲突的话，<code>Merge</code>命令会自动合并，否则需要人工解决这些冲突。</p>
</blockquote>
<p>如果提示<code>Automatic merge failed; fix conflicts and then commit the result.</code>，说明自动合并失败。</p>
<p>此时可以通过<code>git status</code>来查看冲突情况，一般会有这样的提示<code>both modified:   xxxxx</code>。</p>
<hr>
<p> <code>merge</code>是一种<code>不修改分支历史提交记录</code>的方式，这也是我们常用的方式。</p>
<hr>
<h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3><p><code>Rebase</code>会把从<code>Merge Base</code>以来的所有提交以补丁的形式一个一个重新达到目标分支上。</p>
<p><img src="/images/15240981289836.jpg" alt=""></p>
<hr>
<p>与<code>Merge</code>不同，<code>Rebase</code>会重新修改基于远程分支的commit，使得目标分支合并该分支的时候会直接<code>Fast Forward</code>，即不会产生任何冲突，提交历史是一条线，这对强迫症患者可谓是一大福音。</p>
<p>由于一条线提交历史也可以保证分支功能在master分支上是<code>有序的</code>。</p>
<hr>
<p><code>Rebase</code>还可以用来修改历史commit，一般在写代码的时候经常会提交一些无效的commit，这些commit不利于代码review，从commit中不能获得此次的改动点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">commit af6922a5d3d31a4f3816a27a14476f62a533579e</span><br><span class="line">Author: xxxx</span><br><span class="line">Date:   Fri Mar 16 10:17:50 2018 +0800</span><br><span class="line">    fix bug</span><br><span class="line">...</span><br><span class="line">commit 71966c45a79dcf7ae13842feea61d61ba77fa120</span><br><span class="line">Author: xxxx</span><br><span class="line">Date:   Thu Mar 15 19:58:03 2018 +0800</span><br><span class="line">    fix bg</span><br></pre></td></tr></table></figure>
<p>可使用<code>Rebase</code>命令如下，其中xxx代表base为xxx的commit。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i &lt;comment-id&gt;</span><br></pre></td></tr></table></figure></p>
<p>执行结果如下，其中可以通过修改<code>pick</code>来实现修改commit操作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pick e0f56d9 fix bug</span><br><span class="line">s f3s0281 fix bug</span><br><span class="line">s a310682 fix bug</span><br><span class="line">s 1902931 fix bug</span><br><span class="line"></span><br><span class="line"># Commands:</span><br><span class="line"># p, pick = use commit</span><br><span class="line"># r, reword = use commit, but edit the commit message</span><br><span class="line"># e, edit = use commit, but stop for amending</span><br><span class="line"># s, squash = use commit, but meld into previous commit</span><br><span class="line"># f, fixup = like &quot;squash&quot;, but discard this commit&apos;s log message</span><br><span class="line"># x, exec = run command (the rest of the line) using shell</span><br><span class="line"># d, drop = remove commit</span><br></pre></td></tr></table></figure></p>
<p><strong>一般使用的姿势如下：</strong></p>
<p>通过<code>edit</code>来修改目标commit的内容</p>
<p><img src="/images/15240981389227.jpg" alt=""></p>
<p>通过<code>squash</code>来合并多个commit的内容</p>
<p><img src="/images/15240981445332.jpg" alt=""></p>
<hr>
<h3 id="Branch、Checkout、Revert、Reset"><a href="#Branch、Checkout、Revert、Reset" class="headerlink" title="Branch、Checkout、Revert、Reset"></a>Branch、Checkout、Revert、Reset</h3><p>创建分支的两种方式：</p>
<p><code>git branch new_branch</code> =&gt; 创建新分支</p>
<p><code>git checkout -b new_branch</code> =&gt; 创建并切换到新分支</p>
<hr>
<p><code>Revert</code>一般被称为反向提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;comment-id&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>什么是反向提交呢，就是旧版本添加了的内容，要在新版本中删除，旧版本中删除了的内容，要在新版本中添加。这在分支已经推送到远程仓库的情境下非常有用。</p>
</blockquote>
<p><code>Revert也不会修改历史提交记录</code>，实际的操作相当于是检出目标提交的项目快照到工作区与暂存区，然后用一个新的提交完成版本的<code>回退</code>。</p>
<hr>
<p>与<code>Revert</code>很像，<code>Reset</code>用来在当前分支进行版本的“回退”，不同的是，<code>Reset 是会修改历史提交记录的</code>。</p>
<p><code>Reset</code>常用的选项有三个，分别是<code>soft</code>,  <code>mixed</code>, <code>hard</code>，他们的作用域依次增大。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --&lt;option&gt; &lt;comment-id&gt;</span><br></pre></td></tr></table></figure>
<p><code>soft</code>选项仅会修改分支指向，而不修改工作区与暂存区的内容，可以重新做一次提交，形成一个新的 commit，常用与撤销临时提交的场景。</p>
<blockquote>
<p><code>soft</code>可用于上面多个无效commit的合并（只使用于合并当前commit之前的连续commit）。</p>
</blockquote>
<p><code>mixed</code>比<code>soft</code>的作用域多了一个 暂存区，实际上<code>mixed 选项与 soft 只差了一个 add 操作</code>。</p>
<p><code>hard</code>选项会导致工作区内容“丢失”，因此在使用 <code>hard</code> 选项时，一定要确保知道自己在做什么，避免丢失分支内容。</p>
<blockquote>
<p>如果真的误用了<code>hard</code>，造成了数据丢失怎么办？<br>如果真的误操作了，也不要慌，因为只要 git 一般不会主动删除本地仓库中的内容，根据你丢失的情况，可以进行找回，解决方法有两种：<br>一、使用 <code>git reset --hard ORIG_HEAD</code>立即恢复<br>二、使用 <code>reflog</code>命令查看之前分支的引用</p>
</blockquote>
<h3 id="Stash"><a href="#Stash" class="headerlink" title="Stash"></a>Stash</h3><p><code>stash</code>将工作区与暂存区中的内容做一个提交并保存起来，然后使用<code>reset hard</code>选项恢复工作区与暂存区内容。我们可以随时使用 <code>stash apply</code> 将修改应用回来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br><span class="line">git stash apply</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用场景：有时，我们在一个分支上做了一些工作，修改了很多代码，而这时需要切换到另一个分支干点别的事。但又不想将只做了一半的工作提交。在曾经这样做过，将当前的修改做一次提交，message 填写 half of work，然后切换另一个分支去做工作，完成工作后，切换回来使用 <code>reset —soft</code>（重新提交commit）或者是 <code>commit amend</code>（修改commit）。</p>
</blockquote>
<h3 id="cherry-pick"><a href="#cherry-pick" class="headerlink" title="cherry-pick"></a>cherry-pick</h3><p><code>cherry-pick</code>用于把另一个本地分支的commit修改应用到当前分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick &lt;comment-id&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果在cherry-pick 的过程中出现了冲突？和rebase和merge一样，都需要手动解决冲突再提交。</p>
</blockquote>
<h3 id="set-upstream"><a href="#set-upstream" class="headerlink" title="set-upstream"></a>set-upstream</h3><p><code>set-upstream</code>用于设置分支跟踪关系。</p>
<p>一般本地新建一个分支再往远程仓库推送的时候，需要指定远程仓库的目标分支。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin &lt;new_branch&gt;</span><br><span class="line">git branch --set-upstream-to=&lt;target branch&gt; &lt;new_branch&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="pull-amp-fetch"><a href="#pull-amp-fetch" class="headerlink" title="pull &amp; fetch"></a>pull &amp; fetch</h3><p><code>pull</code>=<code>fetch</code>+<code>merge</code>。</p>
<p><code>pull</code>是下拉远程分支并与本地分支合并。<code>fetch</code>只是下拉远程分支，并不会发生合并需要手动执行合并。</p>
<p>也可以采用<code>rebase</code>模式，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase</span><br></pre></td></tr></table></figure></p>
<p>该命令做了以下内容：<br>一、把你 commit 到本地仓库的内容，取出来放到暂存区(<code>stash</code>)（这时你的工作区是干净的）<br>二、然后从远端拉取代码到本地，由于工作区是干净的，所以不会有冲突<br>三、从暂存区把你之前提交的内容取出来，跟拉下来的代码合并</p>
<blockquote>
<p><code>rebase</code>在拉代码前要确保你本地工作区是干净的，如果你本地修改的内容没完全 commit 或者 stash，就会 rebase 失败。</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.coding.net/blog/principle-of-Git" target="_blank" rel="noopener">https://blog.coding.net/blog/principle-of-Git</a><br><a href="http://www.bootcss.com/p/git-guide/" target="_blank" rel="noopener">http://www.bootcss.com/p/git-guide/</a><br><a href="https://www.cnblogs.com/dogdogwang/p/7072931.html" target="_blank" rel="noopener">https://www.cnblogs.com/dogdogwang/p/7072931.html</a></p>

    
	</div>
	
    
<nav id="article-nav">
  
    <a href="/2018/12/20/e-commerce-architecture/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          电商架构
        
      </div>
    </a>
  
  
    <a href="/2017/12/21/block-chain/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          区块链
        
      </div>
    </a>
  
</nav>

  
</article>





    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:simyy.cn">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">simyy</a>
	</h1>
    &nbsp;&nbsp;
	<span class="copyright">
		&copy; 2019 simyy  Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>

    

<script src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>