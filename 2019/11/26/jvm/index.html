<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Java 虚拟机 | simyy</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Java虚拟机（Java Virtual Machine）是一种能够运行Java字节码的虚拟机。">
<meta name="keywords" content="Java,JVM">
<meta property="og:type" content="article">
<meta property="og:title" content="Java 虚拟机">
<meta property="og:url" content="http://simyy.cn/2019/11/26/jvm/index.html">
<meta property="og:site_name" content="simyy">
<meta property="og:description" content="Java虚拟机（Java Virtual Machine）是一种能够运行Java字节码的虚拟机。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://simyy.cn/images/JVM_1.jpg">
<meta property="og:image" content="http://simyy.cn/images/JVM_2.jpg">
<meta property="og:image" content="http://simyy.cn/images/JVM_3.jpg">
<meta property="og:image" content="http://simyy.cn/images/JVM_4.jpg">
<meta property="og:updated_time" content="2019-12-05T14:27:00.606Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java 虚拟机">
<meta name="twitter:description" content="Java虚拟机（Java Virtual Machine）是一种能够运行Java字节码的虚拟机。">
<meta name="twitter:image" content="http://simyy.cn/images/JVM_1.jpg">
  
    <link rel="alternative" href="/atom.xml" title="simyy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head></html>
<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">simyy</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://simyy.cn"></form>
	</div>
</header>
    <div id="main">
      


<article id="post-jvm" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2019/11/26/jvm/" class="article-date">
  <time datetime="2019-11-26T11:36:26.000Z" itemprop="datePublished">2019-11-26</time>
</a>

		</span>
        <span class="tags">
	       	
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

		</span>
		<!--span class="meta-elements author">simyy</span-->
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      Java 虚拟机
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p><code>Java虚拟机（Java Virtual Machine）</code>是一种能够运行<code>Java字节码</code>的虚拟机。</p>
<a id="more"></a>
<p>实际上只要编译文件符合JVM对加载编译文件格式要求，任何语言都可以由JVM编译运行，例如<code>JPython</code>、<code>Scala</code>、<code>JRupy</code>。</p>
<h3 id="总体结构"><a href="#总体结构" class="headerlink" title="总体结构"></a>总体结构</h3><p><code>Java虚拟机</code>主要被划分为四部分： </p>
<ul>
<li><code>类加载器（ClassLoader）</code></li>
<li><code>运行时数据区（Runtime Data Area）</code></li>
<li><code>执行引擎（Execution Engine）</code></li>
<li><code>本地库接口（Native Interface）</code></li>
</ul>
<p><img src="/images/JVM_1.jpg" alt=""></p>
<blockquote>
<p><code>Java</code>是如何<code>跨平台</code>运行的？</p>
<p><code>Java虚拟机</code>在这里充当了<code>桥梁</code>的作用，通过屏蔽了具体操作系统的API(不同平台JVM实现有所不同)，只要生成<code>Java字节码</code>就可以在多平台不加修改的运行。</p>
</blockquote>
<h4 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h4><p><code>类加载器（ClassLoader）</code>负责把class加载到JVM。</p>
<p><img src="/images/JVM_2.jpg" alt=""></p>
<p>Java文件再被JVM处理之前，需要编译成<code>Java字节码</code>格式的class文件，然后通过类加载器加载到JVM。</p>
<h4 id="执行引擎"><a href="#执行引擎" class="headerlink" title="执行引擎"></a>执行引擎</h4><p><code>Java虚拟机</code>通过模拟操作系统实现了一套虚拟架构，包括<code>处理器</code>、<code>堆栈</code>、<code>寄存器</code>等。</p>
<p><code>执行引擎（Execution Engine）</code>就是模拟操作系统执行命令的原理，以指令为单位读取<code>Java字节码</code>。</p>
<blockquote>
<p><code>Java字节码</code>指令都由<code>操作码</code>和<code>操作数</code>组成。</p>
</blockquote>
<p><code>Java字节码</code>是实现跨平台的关键，所以在不同平台并不能直接执行，这就需要<code>不同平台实现各自的执行引擎来</code>生成各自可执行机器语言。</p>
<hr>
<p>在<code>Java虚拟机</code>中，存在三种执行方式：</p>
<p><strong>解释器模式</strong>：读取字节码解释并且执行字节码指令，由于省去编译时间，应用启动快，但执行效率差，<code>Python</code>默认就是采用此方法。</p>
<p><strong>JIT编译模式</strong>：通过把字节码编译成机器码达到提供执行效率的方法，由于在程序运行前需要编译，导致程序启动慢，但是执行效率高。</p>
<blockquote>
<p><code>JIT（Just In Time）即时编译</code>：在程序运行中对<code>热点代码</code>进行即时编译成机器码，从而提高程序运行效率。<code>热点代码（HotSpotCode）</code>可划分为：<code>多次被调用的方法</code>和<code>多次被执行的循环体</code>。</p>
</blockquote>
<p><strong>混合模式</strong>：上面两种模式的混合，在适合的时候选择合适的模式，从而解决两种模式存在的问题。</p>
<p><img src="/images/JVM_3.jpg" alt=""></p>
<blockquote>
<p><code>Java虚拟机</code>到底采用那种模式呢？</p>
<p>实际上，不同的JVM采用了不同的方式，<code>HotSpotVM</code>才用了混合模式来执行引擎，而<code>JRockitVM</code>才用了<code>JIT编译模式</code>(并没有实现解析器)。<br>如果对解释和编译感兴趣的话，可以戳一下 <a href="https://www.zhihu.com/question/37389356" target="_blank" rel="noopener">为什么 JVM 不用 JIT 全程编译？</a></p>
</blockquote>
<h4 id="本地库接口"><a href="#本地库接口" class="headerlink" title="本地库接口"></a>本地库接口</h4><p><code>本地接口</code>的作用是融合不同的编程语言为<code>Java虚拟机</code>所用，其一般被称为JNI（Java Native Interface）。</p>
<blockquote>
<p><strong>wikipedia</strong>： <code>JNI</code>是一种编程框架，使得<code>Java虚拟机</code>中的Java程序可以<code>调用本地应用/或库</code>，也可以<code>被其他程序调用</code>。</p>
</blockquote>
<h4 id="运行时数据区"><a href="#运行时数据区" class="headerlink" title="运行时数据区"></a>运行时数据区</h4><p><code>运行时数据区</code>是<code>Java虚拟机</code>中最重要的组成部分，也常被称为<code>JVM内存</code>。</p>
<p><img src="/images/JVM_4.jpg" alt=""></p>
<p><code>JVM内存</code>可分为以下<code>五个部分</code>：</p>
<p><strong>方法区</strong>：<code>线程共享</code>，主要用于存储<code>加载的类信息</code>、<code>常量池</code>、<code>静态变量</code>、<code>JIT编译的代码</code>等。</p>
<hr>
<blockquote>
<p>实际上不同JVM实现上也有所不同，</p>
<ul>
<li><code>JDK1.7</code>中，已经把放在永久代的<code>字符串常量池</code>移到<code>堆</code>中。</li>
<li><code>JDK1.8</code>中，已经把放在永久代的<code>静态变量</code>移到<code>堆</code>中。</li>
<li><code>JDK1.8</code>撤销<code>永久代(Perm)</code>，引入<code>元空间(Metaspace)</code>（存放在本地内存，不在受JVM内存限制）。</li>
<li>其他VM都不存在永久代，例如，<code>JRockitVM</code>就没有<code>永久代</code>。</li>
</ul>
</blockquote>
<blockquote>
<p><code>JDK1.8</code>中JVM进程占用的内存会多出来1G？</p>
</blockquote>
<p>由于<code>JDK1.8</code>默认开启了<code>-XX:+UseCompressedClassPointers</code>，<code>CompressedClassSpace</code>默认值为<code>1G</code>，因此会发现JVM进程占用的内存会多出来1G。</p>
<hr>
<p><strong>堆</strong>：<code>线程共享</code>，用于存储对象，是<code>GC</code>的主要区域。</p>
<p>与<code>C/C++</code>不同之处就在于此，<code>Java虚拟机</code>为开发者省去了内存管理的麻烦，也降低了软件开发和维护的难度。</p>
<p>内存管理一般会涉及到<code>内存释放的时机</code>、<code>内存碎片</code>、<code>并发清理内存垃圾的性能</code>等问题。</p>
<p>具体GC算法可以戳 <a href="http://simyy.cn/2017/01/25/gc/">垃圾回收GC</a></p>
<hr>
<p><strong>虚拟机栈</strong>：<code>线程独占</code>，用于存储<code>局部变量表、操作栈、动态链接、方法返回地址</code>等信息。</p>
<blockquote>
<p><code>局部变量表</code>：是用于存放<code>方法参数</code>和方法内部定义的<code>局部变量</code>，在<code>编译期确定</code>最大容量。<br><code>操作栈</code>：执行引擎就是基于<code>操作栈</code>来工作的，在<code>编译期确定</code>最大容量。<br><code>动态链接</code>：运行期加载的<code>常量池</code>中关联当前方法的<code>符号引用</code>。</p>
</blockquote>
<hr>
<p><strong>本地方法栈</strong>：<code>线程独占</code>，用于执行<code>本地方法（Native Method）</code>。</p>
<hr>
<p><strong>程序计数器</strong>：<code>线程独占</code>，用于保存当前线程执行的内存地址，用于JVM程序多线程切换后恢复执行环境。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>Java虚拟机</code>不仅提供了<code>平台无关</code>运行环境，并且接管了<code>内存管理</code>机制，从而使得<code>Java</code>开发、维护变得简单和流行。</p>

    
	</div>
	
    
<nav id="article-nav">
  
    <a href="/2019/12/08/distributed-job-dispatch/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          distributed_job_dispatch
        
      </div>
    </a>
  
  
    <a href="/2019/11/10/topological-sort/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          拓扑排序
        
      </div>
    </a>
  
</nav>

  
</article>







    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:simyy.cn">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">simyy</a>
	</h1>
    &nbsp;&nbsp;
	<span class="copyright">
		&copy; 2019 simyy  Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>

    

<script src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>